<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><script>window.location.replace("https://u.wechat.com/EGOTnhKvIW4hay78pixNuBo")</script><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>ckeditor 插件机制中用到的设计模式 | 蓝色天空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ckeditor 插件机制中用到的设计模式</h1><a id="logo" href="/.">蓝色天空</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ckeditor 插件机制中用到的设计模式</h1><div class="post-meta">Jun 10, 2016<span> | </span><span class="category"><a href="/categories/js/">js</a><a href="/categories/js/ckeditor/">ckeditor</a></span></div><div class="post-content"><h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>代理模式（Proxy），为其他对象提供一种代理以控制对这个对象的访问。</p>
<p>代理模式使得代理对象控制具体对象的引用。代理几乎可以是任何对象：文件，资源，内存中的对象，或者是一些难以复制的东西。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Adds a command definition to the editor instance. Commands added with</span></span><br><span class="line"><span class="comment">	 * this function can be executed later with the &lt;code&gt;&#123;@link #execCommand&#125;&lt;/code&gt; method.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * 		editorInstance.addCommand( 'sample', &#123;</span></span><br><span class="line"><span class="comment">	 * 			exec: function( editor ) &#123;</span></span><br><span class="line"><span class="comment">	 * 				alert( 'Executing a command for the editor name "' + editor.name + '"!' );</span></span><br><span class="line"><span class="comment">	 * 			&#125;</span></span><br><span class="line"><span class="comment">	 * 		&#125; );</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param &#123;String&#125; commandName The indentifier name of the command.</span></span><br><span class="line"><span class="comment">	 * @param &#123;CKEDITOR.commandDefinition&#125; commandDefinition The command definition.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	addCommand: <span class="function"><span class="keyword">function</span>(<span class="params"> commandName, commandDefinition </span>) </span>&#123;</span><br><span class="line">		commandDefinition.name = commandName.toLowerCase();</span><br><span class="line">		<span class="keyword">var</span> cmd = <span class="keyword">new</span> CKEDITOR.command( <span class="keyword">this</span>, commandDefinition );</span><br><span class="line">		<span class="comment">// Update command when mode is set.</span></span><br><span class="line">		<span class="comment">// This guarantees that commands added before first editor#mode</span></span><br><span class="line">		<span class="comment">// aren't immediately updated, but waits for editor#mode and that</span></span><br><span class="line">		<span class="comment">// commands added later are immediately refreshed, even when added</span></span><br><span class="line">		<span class="comment">// before instanceReady. #10103, #10249</span></span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.mode )</span><br><span class="line">			updateCommand( <span class="keyword">this</span>, cmd );</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.commands[ commandName ] = cmd;</span><br><span class="line">	&#125;,</span><br></pre></td></tr></table></figure>
<p>代理模式一般适用于如下场合：</p>
<ol>
<li>远程代理，也就是为了一个对象在不同的地址空间提供局部代表，这样可以隐藏一个对象存在于不同地址空间的事实，就像web service里的代理类一样。</li>
<li>虚拟代理，根据需要创建开销很大的对象，通过它来存放实例化需要很长时间的真实对象，比如浏览器的渲染的时候先显示问题，而图片可以慢慢显示（就是通过虚拟代理代替了真实的图片，此时虚拟代理保存了真实图片的路径和尺寸。</li>
<li>安全代理，用来控制真实对象访问时的权限，一般用于对象应该有不同的访问权限。</li>
<li>智能指引，只当调用真实的对象时，代理处理另外一些事情。例如C#里的垃圾回收，使用对象的时候会有引用次数，如果对象没有引用了，GC就可以回收它了。</li>
</ol>
<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p>命令模式(Command Pattern)：将一个请求封装为一个对象，从而使我们可用不同的请求对客户进行参数化；对请求排队或者记录请求日志，以及支持可撤销的操作。命令模式是一种对象行为型模式，其别名为动作(Action)模式或事务(Transaction)模式。<br>抽象命令类中声明了用于执行请求的execute()等方法，通过这些方法可以调用请求接收者的相关操作；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CKEDITOR.command = <span class="function"><span class="keyword">function</span>(<span class="params"> editor, commandDefinition </span>) </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Lists UI items that are associated to this command. This list can be</span></span><br><span class="line"><span class="comment">	 * used to interact with the UI on command execution (by the execution code</span></span><br><span class="line"><span class="comment">	 * itself, for example).</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *		alert( 'Number of UI items associated to this command: ' + command.uiItems.length );</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">this</span>.uiItems = [];</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Executes the command.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *		command.exec(); // The command gets executed.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * **Note:** You should use the &#123;@link CKEDITOR.editor#execCommand&#125; method instead of calling</span></span><br><span class="line"><span class="comment">	 * `command.exec()` directly.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * @param &#123;Object&#125; [data] Any data to pass to the command. Depends on the</span></span><br><span class="line"><span class="comment">	 * command implementation and requirements.</span></span><br><span class="line"><span class="comment">	 * @returns &#123;Boolean&#125; A boolean indicating that the command has been successfully executed.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">this</span>.exec = <span class="function"><span class="keyword">function</span>(<span class="params"> data </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.state == CKEDITOR.TRISTATE_DISABLED || !<span class="keyword">this</span>.checkAllowed() )</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.editorFocus ) <span class="comment">// Give editor focus if necessary (#4355).</span></span><br><span class="line">			editor.focus();</span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.fire( <span class="string">'exec'</span> ) === <span class="literal">false</span> )</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">return</span> ( commandDefinition.exec.call( <span class="keyword">this</span>, editor, data ) !== <span class="literal">false</span> );</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体命令类是抽象命令类的子类，实现了在抽象命令类中声明的方法，它对应具体的接收者对象，将接收者对象的动作绑定其中；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> redoCommand = editor.addCommand( <span class="string">'redo'</span>, &#123;</span><br><span class="line">				exec: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">					<span class="keyword">if</span> ( undoManager.redo() ) &#123;</span><br><span class="line">						editor.selectionChange();</span><br><span class="line">						<span class="keyword">this</span>.fire( <span class="string">'afterRedo'</span> );</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				startDisabled: <span class="literal">true</span>,</span><br><span class="line">				canUndo: <span class="literal">false</span></span><br><span class="line">			&#125; );</span><br></pre></td></tr></table></figure>
<p>调用者即请求的发送者，又称为请求者，它通过命令对象来执行请求；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CKEDITOR.tools.callFunction(<span class="number">103</span>,<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>
<p>接收者执行与请求相关的操作，它具体实现对请求的业务处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.exec = <span class="function"><span class="keyword">function</span>(<span class="params"> data </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.state == CKEDITOR.TRISTATE_DISABLED || !<span class="keyword">this</span>.checkAllowed() )</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.editorFocus ) <span class="comment">// Give editor focus if necessary (#4355).</span></span><br><span class="line">			editor.focus();</span><br><span class="line">		<span class="keyword">if</span> ( <span class="keyword">this</span>.fire( <span class="string">'exec'</span> ) === <span class="literal">false</span> )</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">return</span> ( commandDefinition.exec.call( <span class="keyword">this</span>, editor, data ) !== <span class="literal">false</span> );</span><br><span class="line">	&#125;;</span><br></pre></td></tr></table></figure>
<p>在命令模式中，将一个请求封装为一个对象，从而使我们可用不同的请求对客户进行参数化；对请求排队或者记录请求日志，以及支持可撤销的操作。命令模式是一种对象行为型模式，其别名为动作模式或事务模式。<br>命令模式包含四个角色：抽象命令类中声明了用于执行请求的execute()等方法，通过这些方法可以调用请求接收者的相关操作；具体命令类是抽象命令类的子类，实现了在抽象命令类中声明的方法，它对应具体的接收者对象，将接收者对象的动作绑定其中；调用者即请求的发送者，又称为请求者，它通过命令对象来执行请求；接收者执行与请求相关的操作，它具体实现对请求的业务处理。<br>命令模式的本质是对命令进行封装，将发出命令的责任和执行命令的责任分割开。命令模式使请求本身成为一个对象，这个对象和其他对象一样可以被存储和传递。<br>命令模式的主要优点在于降低系统的耦合度，增加新的命令很方便，而且可以比较容易地设计一个命令队列和宏命令，并方便地实现对请求的撤销和恢复；其主要缺点在于可能会导致某些系统有过多的具体命令类。<br>命令模式适用情况包括：需要将请求调用者和请求接收者解耦，使得调用者和接收者不直接交互；需要在不同的时间指定请求、将请求排队和执行请求；需要支持命令的撤销操作和恢复操作，需要将一组操作组合在一起，即支持宏命令。</p>
</div><div class="tags"><a href="/tags/ckeditor/">ckeditor</a><a href="/tags/js/">js</a></div><div class="post-nav"><a class="pre" href="/2016/06/12/ckeditor 事件机制与发布订阅模式/">ckeditor 事件机制与发布订阅模式</a><a class="next" href="/2016/01/12/ES6语法学习/">ES6语法学习</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://kittboy.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/FE/">FE</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/FE/CSS/">CSS</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/js/ckeditor/">ckeditor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/es6/">es6</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/ckeditor/" style="font-size: 15px;">ckeditor</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/es6/" style="font-size: 15px;">es6</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/FE/" style="font-size: 15px;">FE</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/10/ckeditor 概览/">ckeditor 概览</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/07/ckeditor引导程序/">ckeditor引导程序</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/16/ckeditor插件机制/">ckeditor插件机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/12/ckeditor 事件机制与发布订阅模式/">ckeditor 事件机制与发布订阅模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/10/ckeditor 插件机制中用到的设计模式/">ckeditor 插件机制中用到的设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/12/ES6语法学习/">ES6语法学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/12/git常用命令/">git常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/15/移动端无缝适配的几种实现方式/">移动端无缝适配的几种实现方式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">蓝色天空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>
